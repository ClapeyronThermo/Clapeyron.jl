<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Custom Methods · Clapeyron.jl</title><meta name="title" content="Custom Methods · Clapeyron.jl"/><meta property="og:title" content="Custom Methods · Clapeyron.jl"/><meta property="twitter:title" content="Custom Methods · Clapeyron.jl"/><meta name="description" content="Documentation for Clapeyron.jl."/><meta property="og:description" content="Documentation for Clapeyron.jl."/><meta property="twitter:description" content="Documentation for Clapeyron.jl."/><meta property="og:url" content="https://ClapeyronThermo.github.io/Clapeyron.jl/user_guide/custom_methods/"/><meta property="twitter:url" content="https://ClapeyronThermo.github.io/Clapeyron.jl/user_guide/custom_methods/"/><link rel="canonical" href="https://ClapeyronThermo.github.io/Clapeyron.jl/user_guide/custom_methods/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/logo.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Clapeyron.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Clapeyron.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../theory/background/">Background</a></li><li><a class="tocitem" href="../basic_usage/">Basic Usage</a></li><li><span class="tocitem">Customization</span><ul><li><a class="tocitem" href="../custom_dtb/">Custom Databases</a></li><li class="is-active"><a class="tocitem" href>Custom Methods</a><ul class="internal"><li><a class="tocitem" href="#Definitions"><span>Definitions</span></a></li><li><a class="tocitem" href="#Custom-initial-guesses-example"><span>Custom initial guesses example</span></a></li><li><a class="tocitem" href="#Custom-volume-solver"><span>Custom volume solver</span></a></li><li><a class="tocitem" href="#Custom-saturation-solver"><span>Custom saturation solver</span></a></li><li><a class="tocitem" href="#Custom-TP-Flash-solver"><span>Custom TP-Flash solver</span></a></li><li><a class="tocitem" href="#I-have-a-better-method..."><span>I have a better method...</span></a></li></ul></li><li><a class="tocitem" href="../custom_model/">Custom Models</a></li></ul></li><li><a class="tocitem" href="../../notebook_examples/">Notebook Examples</a></li><li><a class="tocitem" href="../../to-do_list/">To-do list</a></li><li><span class="tocitem">Available EoS</span><ul><li><a class="tocitem" href="../../eos/ideal/">Ideal Models</a></li><li><a class="tocitem" href="../../eos/cubic/">Cubic Models</a></li><li><a class="tocitem" href="../../eos/activity/">Activity Models</a></li><li><a class="tocitem" href="../../eos/saft/">SAFT and CPA Models</a></li><li><a class="tocitem" href="../../eos/empiric/">Empiric Helmholtz Models</a></li><li><a class="tocitem" href="../../eos/correlations/">Property Correlations</a></li><li><a class="tocitem" href="../../eos/misc/">Other Models</a></li></ul></li><li><span class="tocitem">Available Properties</span><ul><li><a class="tocitem" href="../../properties/basic/">Basic Properties</a></li><li><a class="tocitem" href="../../properties/bulk/">Bulk Properties</a></li><li><a class="tocitem" href="../../properties/single/">Single phase Properties</a></li><li><a class="tocitem" href="../../properties/multi/">Multiphase Properties</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/parameters/">Parameters</a></li><li><a class="tocitem" href="../../api/macros/">Macros</a></li><li><a class="tocitem" href="../../api/association/">Association</a></li><li><a class="tocitem" href="../../api/estimation/">Parameter Estimation</a></li></ul></li><li><a class="tocitem" href="../../dev/">Developer Guide</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Customization</a></li><li class="is-active"><a href>Custom Methods</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Custom Methods</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ClapeyronThermo/Clapeyron.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ClapeyronThermo/Clapeyron.jl/blob/master/docs/src/user_guide/custom_methods.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Definitions"><a class="docs-heading-anchor" href="#Definitions">Definitions</a><a id="Definitions-1"></a><a class="docs-heading-anchor-permalink" href="#Definitions" title="Permalink"></a></h2><p>Within <code>Clapeyron</code>, we provide a few methods which we use to obtain thermodynamic properties (you can find out more details on how we implement these methods in our background information):</p><ul><li><code>[volume](@ref)(model, p, T, z)</code>: Obtains the volume of a system at a given temperature, pressure and composition. If the phase is unknown, it will find the vapour and liquid roots and return the one that minimises the Gibbs free energy. This function is called by all of our bulk property methods.</li><li><code>[saturation_pressure](@ref)(model, T)</code>: Obtains the saturation pressures and volumes for a pure species.</li><li><code>[crit_pure](@ref)(model)</code>: Obtains the critical point for a pure species.</li></ul><p>Clearly this is not an exhaustive list and we make absolutely no guarantees as to the quality of these methods. However, if you have a new method or algorithm you would like to implement or test out, it is possible to do so.</p><h2 id="Custom-initial-guesses-example"><a class="docs-heading-anchor" href="#Custom-initial-guesses-example">Custom initial guesses example</a><a id="Custom-initial-guesses-example-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-initial-guesses-example" title="Permalink"></a></h2><p>One of the most common reasons for our methods to fail (that we&#39;ve seen) is due to poor initial guesses. If you are experiencing issues with our <code>saturation_pressure</code> method specifically, you could try modifying the initial guess for a particular equation of state (see the custom models documentation for explanation on abstract types):</p><pre><code class="language-julia hljs">function Clapeyron.x0_sat_pure(model::PCSAFTModel,T,z=SA[1.0])
  # Obtain the volume lower bound for that particular system
  Vlb = lb_volume(model,z)*one(T)
  
  # Relative to the lower bound, define your initial guesses. We log10 the results as our solvers solve for the log10 of the volume.
  return Vlb*1.5,Vlb*100
end</code></pre><p>Note that we do need prefix [<code>x0_sat_pure</code>] with <code>Clapeyron.</code> as we do not export this function normally; including this function in our script with force Clapeyron to use it instead of the default. These modifications can also be done for <code>x0_crit_pure</code> although <code>crit_pure</code> has proven to be quite reliable.</p><h2 id="Custom-volume-solver"><a class="docs-heading-anchor" href="#Custom-volume-solver">Custom volume solver</a><a id="Custom-volume-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-volume-solver" title="Permalink"></a></h2><p>For something a bit more substantial, you can also modify the volume function itself. We do this with cubics (there is a direct procedure for obtaining the volume roots) and ideal models (the volume is the ideal gas). The default solver method (<a href="../../properties/bulk/#Clapeyron.volume"><code>volume</code></a>) can be overloaded by defining:</p><pre><code class="language-julia hljs">function Clapeyron.volume_impl(model::MyEoSModel,p,T,z=SA[1.0],phase=:unknown,threaded=false,vol0=nothing)
  
  # INSERT YOUR ALGORITHM HERE
  
  return vol
end</code></pre><p>Clapeyron will automatically call your implementation when your model is evaluated. </p><h2 id="Custom-saturation-solver"><a class="docs-heading-anchor" href="#Custom-saturation-solver">Custom saturation solver</a><a id="Custom-saturation-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-saturation-solver" title="Permalink"></a></h2><p>For saturation solvers (<a href="../../properties/single/#Clapeyron.saturation_pressure"><code>saturation_pressure</code></a>,<a href="../../properties/single/#Clapeyron.saturation_temperature"><code>saturation_temperature</code></a>), You can dispatch on a different saturation method. let&#39;s create one, that just evaluates antoine coefficients:</p><pre><code class="language-julia hljs">struct DirectAntoine{C} &lt;: Clapeyron.SaturationMethod
  A::Float64
  B::Float64
  C::Float64
  crit::C
end

#defining interface, check Clapeyron.SaturationMethod for more information
#All saturation methods require passing crit as a keyword

DirectAntoine(A,B,C;crit = nothing) = DirectAntoine(A,B,C,crit)

function Clapeyron.saturation_temperature_impl(model::EoSModel,T,method::DirectAntoine)
  A = method.A
  B = method.B
  C = method.C
  p = exp(A + B/(T+C))
  vl = volume(model,p,T,phase = :l)
  vv = volume(model,p,T,phase = :v)
  return p,vl,vv
end</code></pre><p>you can now call <code>saturation_pressure(model,T,method)</code> where <code>method = DirectAntoine(A,B,C)</code>. At the moment, the default algorithm iterates directly over volumes (<code>[ChemPotVSaturation](@ref)</code>), but we also have saturation via isofugacity (<code>[IsofugacitySaturation](@ref)</code>) and superancillaries for cubics (<code>[SuperAncSaturation](@ref)</code>). the same thing can be done with <code>saturation_temperature</code>.</p><h2 id="Custom-TP-Flash-solver"><a class="docs-heading-anchor" href="#Custom-TP-Flash-solver">Custom TP-Flash solver</a><a id="Custom-TP-Flash-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-TP-Flash-solver" title="Permalink"></a></h2><p>We support the same procedure to define your custom Temperature-pressure flash methods:</p><pre><code class="language-julia hljs">struct MyRachfordRice{K} &lt;: Clapeyron.TPFlashMethod
  K0::K
end

#defining interface, check Clapeyron.TPFlashMethod for more information
numphases(::MyRachfordRice) = 2
#we perform index reduction, to create smaller models in case one component has zero composition.
function Clapeyron.index_reduction(method::MyRachfordRice,non_zero_indices) 
  return MyRachfordRice(index_reduction(method.K0,non_zero_indices))
end

function Clapeyron.tp_flash_impl(model::EoSModel,p,T,z,method::MyRachfordRice)
  #perform rachford rice,returns x, y, α₀
  #...
  X = vcat(x&#39;,y&#39;)
  n = X.*[1-α₀
                α₀]  .* sum(z)
  g = (gibbs_free_energy(model,p,T,x)*(1-α₀)+gibbs_free_energy(model,p,T,y)*α₀)/R̄/T
  return X,n,g
end
</code></pre><h2 id="I-have-a-better-method..."><a class="docs-heading-anchor" href="#I-have-a-better-method...">I have a better method...</a><a id="I-have-a-better-method...-1"></a><a class="docs-heading-anchor-permalink" href="#I-have-a-better-method..." title="Permalink"></a></h2><p>If your custom methods end up being more-efficient than ours or you develop one that we do not currently support, please do start a pull request and we will gladly add it to the package!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../custom_dtb/">« Custom Databases</a><a class="docs-footer-nextpage" href="../custom_model/">Custom Models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Thursday 11 January 2024 23:24">Thursday 11 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
